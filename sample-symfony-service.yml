services:
    potogan.rest.client:
        factory_service: potogan.rest.client_factory
        factory_method:  build
        arguments:
            - https://example.com

    potogan.rest.client_factory:
        class: Potogan\REST\ClientFactory
        arguments:
            - '@potogan.rest.request_factory'
            - '@potogan.rest.transformer'
            - '@potogan.rest.http_client'
        calls:
            - [ 'addMiddleware', ['@potogan.rest.middleware.aware_request'] ]
            - [ 'addMiddleware', ['@potogan.rest.middleware.body_provider'] ]

    potogan.rest.request_factory:
        alias: any.request_factory.implementation

    potogan.rest.stream_factory:
        alias: any.stream_factory.implementation

    potogan.rest.response_factory:
        alias: any.response_factory.implementation

    potogan.rest.http_client:
        class: Http\Client\Socket\Client
        arguments:
            - '@potogan.rest.response_factory'

    potogan.rest.transformer:
        alias: potogan.rest.transformer.chain

    potogan.rest.transformer.chain:
        class: Potogan\REST\Transformer\Chain
        calls:
            - [ 'addTransformer', ['@potogan.rest.transformer.json']]
            - [ 'addTransformer', ['@potogan.rest.transformer.stream']]

    potogan.rest.transformer.json:
        class: Potogan\REST\Transformer\Json

    potogan.rest.transformer.stream:
        class: Potogan\REST\Transformer\Stream
        arguments:
            - '@potogan.rest.stream_factory'

    potogan.rest.middleware.aware_request:
        class: Potogan\REST\Middleware\AwareRequest

    potogan.rest.middleware.body_provider:
        class: Potogan\REST\Middleware\BodyProvider
        arguments:
            - '@potogan.rest.body_provider'
            - '@potogan.rest.transformer'

    potogan.rest.body_provider:
        alias: potogan.rest.body_provider.chain

    potogan.rest.body_provider.chain:
        class: Potogan\REST\BodyProvider\Chain
        calls:
            - [ 'addProvider', ['@potogan.rest.body_provider.aware_request'] ]

    potogan.rest.body_provider.aware_request:
        class: Potogan\REST\BodyProvider\AwareRequest
